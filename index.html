<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produce Scanner</title>
    <link rel="stylesheet" href="stylei.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Scan Page (Landing) -->
        <div id="scan" class="page active">
            <div class="scan-header">
                <h1>Scan Produce</h1>
                <p>Scan barcode or enter PLU code</p>
            </div>
            
            <div class="scan-content">
                <button class="scan-camera-btn" onclick="startScanner()">
                    <span class="camera-icon">üì∑</span>
                    <span>Open Camera Scanner</span>
                </button>
                
                <div class="divider"><span>or</span></div>
                
                <div class="manual-entry">
                    <input type="text" class="plu-input" placeholder="Enter PLU code" id="pluInput">
                    <button class="submit-btn" onclick="submitPLU()">Submit</button>
                </div>
            </div>
        </div>

        <!-- Inventory Page -->
        <div id="inventory" class="page">
            <div class="inventory-header">
                <h1>My Inventory</h1>
                <p>Your scanned produce</p>
            </div>
            
            <div class="inventory-content">
                <div class="inventory-grid" id="inventoryGrid">
                    <div class="empty-message">
                        <img src="images/empty.png" alt="Empty" class="empty-img">
                        <p>No produce scanned yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="switchPage('scan')">
                <span class="nav-icon">üîç</span>
                <span class="nav-label">Scan</span>
            </button>
            <button class="nav-item" onclick="switchPage('inventory')">
                <span class="nav-icon">üì¶</span>
                <span class="nav-label">Inventory</span>
            </button>
        </nav>

        <!-- Scanner Modal -->
        <div id="scanner-modal" class="scanner-modal">
            <button class="close-scanner-btn" onclick="closeScanner()">‚úï</button>
            <div id="scanner-viewport"></div>
            <div class="scanner-overlay">
                <div class="scanner-box"></div>
                <p class="scanner-hint">Position barcode within frame</p>
                <div class="scanner-manual">
                    <input type="text" id="scannerPLU" placeholder="Or enter PLU">
                    <button onclick="submitScannerPLU()">Go</button>
                </div>
            </div>
        </div>

        <!-- Info Modal (Pop-up) -->
        <div id="info-modal" class="info-modal">
            <div class="info-modal-content">
                <button class="close-info-btn" onclick="closeInfoModal()">‚úï</button>
                
                <div class="info-image-section">
                    <img src="" alt="" id="modalImage" class="modal-produce-img">
                    <h2 id="modalTitle">Produce Name</h2>
                </div>

                <div class="info-tabs">
                    <button class="tab-btn active" onclick="switchTab('nutrition')">Nutrition</button>
                    <button class="tab-btn" onclick="switchTab('origin')">Origin</button>
                    <button class="tab-btn" onclick="switchTab('season')">Season</button>
                </div>

                <div class="tab-content">
                    <div id="nutrition-tab" class="tab-panel active">
                        <h3>Nutritional Information</h3>
                        <div class="nutrition-list" id="nutritionList"></div>
                    </div>
                    
                    <div id="origin-tab" class="tab-panel">
                        <h3>Origin & Growing Info</h3>
                        <p id="originInfo"></p>
                    </div>
                    
                    <div id="season-tab" class="tab-panel">
                        <h3>Seasonality</h3>
                        <p id="seasonInfo"></p>
                    </div>
                </div>

                <button class="done-btn" onclick="closeInfoModal()">Done</button>
            </div>
        </div>
    </div>

    <script>
        let inventory = [];
        let scannerActive = false;
        let currentProduce = null;

        // PLU Database - Your 28 specific items
        const pluDatabase = {
            '93283': { name: 'Honeycrisp Apple', image: 'images/honeycrisp.png' },
            '4036': { name: 'Large Yellow Nectarine', image: 'images/yellow-nectarine.png' },
            '4401': { name: 'White Peach', image: 'images/white-peach.png' },
            '3127': { name: 'Pomegranate', image: 'images/pomegranate.png' },
            '4584': { name: 'Green Mango', image: 'images/green-mango.png' },
            '94256': { name: 'Starfruit', image: 'images/starfruit.png' },
            '4396': { name: 'Papaya', image: 'images/papaya.png' },
            '4237': { name: 'Banana', image: 'images/banana.png' },
            '4317': { name: 'Honeydew Melon', image: 'images/honeydew.png' },
            '94388': { name: 'Lemon', image: 'images/lemon.png' },
            '94282': { name: 'Organic Red Grapefruit', image: 'images/red-grapefruit.png' },
            '94053': { name: 'Lemon', image: 'images/lemon.png' },
            '4048': { name: 'Lime', image: 'images/lime.png' },
            '3040': { name: 'Dragon Fruit', image: 'images/dragon-fruit.png' },
            '94017': { name: 'Granny Smith Apple', image: 'images/granny-smith.png' },
            '4808': { name: 'Tomato', image: 'images/tomato.png' },
            '94040': { name: 'Black Prune', image: 'images/black-prune.png' },
            '94688': { name: 'Bell Pepper', image: 'images/bell-pepper.png' },
            '94763': { name: 'Organic Delicata/Sweet Potato', image: 'images/sweet-potato.png' },
            '4225': { name: 'Avocado', image: 'images/avocado.png' },
            '3616': { name: 'Apple', image: 'images/apple.png' },
            '4032': { name: 'Watermelon', image: 'images/watermelon.png' },
            '3623': { name: 'Melon', image: 'images/melon.png' },
            '94030': { name: 'Green Kiwi', image: 'images/green-kiwi.png' },
            '4409': { name: 'Pear', image: 'images/pear.png' },
            '94415': { name: 'Red Pear', image: 'images/red-pear.png' },
            '4040': { name: 'Black Plum', image: 'images/black-plum.png' },
            '94378': { name: 'Peach', image: 'images/peach.png' }
        };

        // Origin Information
        const originData = {
            'Honeycrisp Apple': 'Originally developed at the University of Minnesota. Commonly grown in the United States, particularly in Minnesota, Michigan, and Washington.',
            'Large Yellow Nectarine': 'Native to China, now widely cultivated in California, Mediterranean regions, and South America.',
            'White Peach': 'Originated in China over 4,000 years ago. Now grown in California, Georgia, and South Carolina in the US.',
            'Pomegranate': 'Native to Iran and northern India. Cultivated throughout the Mediterranean region, Middle East, and California.',
            'Green Mango': 'Originated in South Asia, primarily India. Now grown in tropical and subtropical regions worldwide.',
            'Starfruit': 'Native to Southeast Asia, particularly Malaysia and Indonesia. Also grown in Florida, Hawaii, and the Caribbean.',
            'Papaya': 'Native to Central America and southern Mexico. Now cultivated in tropical regions worldwide, especially Hawaii.',
            'Banana': 'Native to Southeast Asia. Major producers include India, China, Philippines, Ecuador, and Central America.',
            'Honeydew Melon': 'Believed to have originated in France or Algeria. Now grown in warm climates worldwide, especially California.',
            'Lemon': 'Originated in Asia, likely northeastern India. Major producers include India, Mexico, China, and Mediterranean countries.',
            'Organic Red Grapefruit': 'First discovered in Barbados. Now grown in subtropical climates, primarily Florida, Texas, and California.',
            'Lime': 'Native to Southeast Asia. Major producers include Mexico, India, China, and Brazil.',
            'Dragon Fruit': 'Native to Central America. Now cultivated in Southeast Asia, particularly Vietnam, Thailand, and the Philippines.',
            'Granny Smith Apple': 'Originated in Australia in 1868. Now grown worldwide, with major production in the US, Australia, and New Zealand.',
            'Tomato': 'Native to western South America. Now cultivated worldwide, with major producers in China, India, and the United States.',
            'Black Prune': 'Originated from European plums. Primarily grown in California, which produces 99% of US prunes.',
            'Bell Pepper': 'Native to Central and South America. Now grown worldwide, with major production in China, Mexico, and the United States.',
            'Organic Delicata/Sweet Potato': 'Sweet potatoes are native to Central and South America. Major producers include China, Malawi, and the United States.',
            'Avocado': 'Native to south-central Mexico. Major producers include Mexico, Dominican Republic, Peru, and California.',
            'Apple': 'Originated in Central Asia. Now grown worldwide, with major producers in China, United States, and Poland.',
            'Watermelon': 'Originated in Africa. Now cultivated worldwide, with major producers in China, Turkey, and Iran.',
            'Melon': 'Likely originated in Africa or the Middle East. Now grown in warm climates worldwide.',
            'Green Kiwi': 'Native to China, popularized in New Zealand. Major producers include China, Italy, and New Zealand.',
            'Pear': 'Originated in coastal and temperate regions of Asia and Europe. Major producers include China, United States, and Italy.',
            'Red Pear': 'Originated in Europe and Asia. Cultivated in temperate regions worldwide.',
            'Black Plum': 'Originated in Asia. Now grown in temperate climates worldwide, especially California and the Mediterranean.',
            'Peach': 'Native to northwest China. Major producers include China, Spain, Italy, and the United States (especially Georgia and California).'
        };

        // Seasonal Information
        const seasonData = {
            'Honeycrisp Apple': 'Peak season: September through November. Available in storage through winter.',
            'Large Yellow Nectarine': 'Peak season: May through September, with peak availability in July and August.',
            'White Peach': 'Peak season: May through September. Best flavor in summer months.',
            'Pomegranate': 'Peak season: September through January, with best quality in October and November.',
            'Green Mango': 'Available year-round in tropical regions. Peak season varies by growing region.',
            'Starfruit': 'Available year-round, with peak season from August through March.',
            'Papaya': 'Available year-round. Peak season in early summer and fall.',
            'Banana': 'Available year-round. No specific peak season.',
            'Honeydew Melon': 'Peak season: June through October, with best flavor in late summer.',
            'Lemon': 'Available year-round, with peak production in winter and spring.',
            'Organic Red Grapefruit': 'Peak season: November through June. Best quality in winter months.',
            'Lime': 'Available year-round, with peak season in summer months.',
            'Dragon Fruit': 'Peak season: June through September, though available year-round in some regions.',
            'Granny Smith Apple': 'Available year-round. Peak harvest: October through November.',
            'Tomato': 'Available year-round. Peak season: June through September for outdoor-grown varieties.',
            'Black Prune': 'Peak season: August through October. Dried prunes available year-round.',
            'Bell Pepper': 'Available year-round. Peak season: July through September.',
            'Organic Delicata/Sweet Potato': 'Available year-round. Peak harvest: September through November.',
            'Avocado': 'Available year-round, with peak season varying by variety (spring through summer for most).',
            'Apple': 'Available year-round. Peak harvest: September through November.',
            'Watermelon': 'Peak season: May through September, with best quality in July and August.',
            'Melon': 'Peak season: June through September.',
            'Green Kiwi': 'Available year-round. New Zealand kiwis peak November through May; California kiwis October through April.',
            'Pear': 'Peak season: August through February, depending on variety.',
            'Red Pear': 'Peak season: August through February.',
            'Black Plum': 'Peak season: May through October, with best quality in summer months.',
            'Peach': 'Peak season: May through September. Best flavor in June, July, and August.'
        };

        // Nutrition Data
        const nutritionData = {
            'Honeycrisp Apple': { calories: 80, carbs: '22g', fiber: '5g', sugar: '16g', vitaminC: '8mg', potassium: '195mg' },
            'Large Yellow Nectarine': { calories: 63, carbs: '15g', fiber: '2.4g', sugar: '11g', vitaminC: '7mg', vitaminA: '332IU' },
            'White Peach': { calories: 59, carbs: '14g', fiber: '2.3g', sugar: '13g', vitaminC: '10mg', vitaminA: '489IU' },
            'Pomegranate': { calories: 83, carbs: '19g', fiber: '4g', sugar: '14g', vitaminC: '10mg', potassium: '236mg' },
            'Green Mango': { calories: 60, carbs: '15g', fiber: '1.6g', sugar: '14g', vitaminC: '36mg', vitaminA: '1082IU' },
            'Starfruit': { calories: 31, carbs: '7g', fiber: '2.8g', sugar: '4g', vitaminC: '34mg', potassium: '133mg' },
            'Papaya': { calories: 62, carbs: '16g', fiber: '2.5g', sugar: '11g', vitaminC: '87mg', vitaminA: '1532IU' },
            'Banana': { calories: 105, carbs: '27g', fiber: '3g', sugar: '14g', potassium: '422mg', vitaminB6: '0.4mg' },
            'Honeydew Melon': { calories: 64, carbs: '16g', fiber: '1.4g', sugar: '14g', vitaminC: '31mg', potassium: '404mg' },
            'Lemon': { calories: 29, carbs: '9g', fiber: '2.8g', sugar: '2.5g', vitaminC: '53mg', folate: '11mcg' },
            'Organic Red Grapefruit': { calories: 52, carbs: '13g', fiber: '2g', sugar: '9g', vitaminC: '38mg', vitaminA: '1414IU' },
            'Lime': { calories: 30, carbs: '11g', fiber: '2.8g', sugar: '1.7g', vitaminC: '32mg', calcium: '33mg' },
            'Dragon Fruit': { calories: 60, carbs: '13g', fiber: '3g', sugar: '8g', vitaminC: '3mg', iron: '0.7mg' },
            'Granny Smith Apple': { calories: 80, carbs: '22g', fiber: '4g', sugar: '15g', vitaminC: '10mg', potassium: '195mg' },
            'Tomato': { calories: 22, carbs: '5g', fiber: '1.5g', sugar: '3g', vitaminC: '17mg', lycopene: '3mg' },
            'Black Prune': { calories: 240, carbs: '64g', fiber: '7g', sugar: '38g', vitaminK: '60mcg', potassium: '732mg' },
            'Bell Pepper': { calories: 30, carbs: '7g', fiber: '2.5g', sugar: '4g', vitaminC: '120mg', vitaminA: '370IU' },
            'Organic Delicata/Sweet Potato': { calories: 112, carbs: '26g', fiber: '4g', sugar: '5g', vitaminA: '19218IU', vitaminC: '3mg' },
            'Avocado': { calories: 234, carbs: '12g', fiber: '10g', fat: '21g', potassium: '690mg', folate: '81mcg' },
            'Apple': { calories: 95, carbs: '25g', fiber: '4g', sugar: '19g', vitaminC: '8mg', potassium: '195mg' },
            'Watermelon': { calories: 46, carbs: '12g', fiber: '0.6g', sugar: '9g', vitaminC: '12mg', lycopene: '6890mcg' },
            'Melon': { calories: 60, carbs: '14g', fiber: '1.6g', sugar: '13g', vitaminC: '65mg', vitaminA: '5986IU' },
            'Green Kiwi': { calories: 61, carbs: '15g', fiber: '3g', sugar: '9g', vitaminC: '93mg', vitaminK: '40mcg' },
            'Pear': { calories: 101, carbs: '27g', fiber: '5.5g', sugar: '17g', vitaminC: '7mg', potassium: '206mg' },
            'Red Pear': { calories: 101, carbs: '27g', fiber: '5.5g', sugar: '17g', vitaminC: '7mg', potassium: '206mg' },
            'Black Plum': { calories: 46, carbs: '11g', fiber: '1.4g', sugar: '10g', vitaminC: '10mg', vitaminA: '345IU' },
            'Peach': { calories: 59, carbs: '14g', fiber: '2.3g', sugar: '13g', vitaminC: '10mg', vitaminA: '489IU' }
        };

        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');
            
            if (pageId === 'inventory') {
                updateInventoryDisplay();
            }
        }

        function submitPLU() {
            const input = document.getElementById('pluInput');
            const code = input.value.trim();
            if (code) {
                lookupProduce(code);
                input.value = '';
            }
        }

        function startScanner() {
            const modal = document.getElementById('scanner-modal');
            modal.classList.add('active');
            scannerActive = true;

            if (typeof Quagga === 'undefined') {
                alert('Scanner library not loaded.');
                closeScanner();
                return;
            }

            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-viewport'),
                    constraints: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: "environment"
                    }
                },
                decoder: {
                    readers: ["ean_reader", "ean_8_reader", "code_128_reader", "upc_reader"]
                },
                locate: true
            }, function(err) {
                if (err) {
                    alert('Camera error. Use manual entry.');
                    closeScanner();
                    return;
                }
                Quagga.start();
            });

            Quagga.onDetected(function(result) {
                const code = result.codeResult.code;
                if (navigator.vibrate) navigator.vibrate(100);
                lookupProduce(code);
            });
        }

        function closeScanner() {
            if (scannerActive) {
                Quagga.stop();
                Quagga.offDetected();
                scannerActive = false;
            }
            document.getElementById('scanner-modal').classList.remove('active');
        }

        function submitScannerPLU() {
            const input = document.getElementById('scannerPLU');
            const code = input.value.trim();
            if (code) {
                lookupProduce(code);
                input.value = '';
            }
        }

        function lookupProduce(code) {
            const cleanCode = code.replace(/^0+/, '');
            if (pluDatabase[cleanCode]) {
                closeScanner();
                const produce = pluDatabase[cleanCode];
                showInfoModal(produce.name, produce.image);
                addToInventory(produce.name, produce.image);
            } else {
                alert(`PLU ${cleanCode} not found in database`);
            }
        }

        function showInfoModal(name, image) {
            currentProduce = { name, image };
            
            document.getElementById('modalImage').src = image;
            document.getElementById('modalImage').alt = name;
            document.getElementById('modalTitle').textContent = name;
            
            // Set nutrition data
            const nutrition = nutritionData[name];
            const nutritionList = document.getElementById('nutritionList');
            nutritionList.innerHTML = Object.entries(nutrition).map(([key, value]) => {
                const label = key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1');
                return `
                    <div class="nutrition-row">
                        <span class="nutrition-label">${label}</span>
                        <span class="nutrition-value">${value}</span>
                    </div>
                `;
            }).join('');
            
            // Set origin and season data
            document.getElementById('originInfo').textContent = originData[name];
            document.getElementById('seasonInfo').textContent = seasonData[name];
            
            document.getElementById('info-modal').classList.add('active');
        }

        function closeInfoModal() {
            document.getElementById('info-modal').classList.remove('active');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        function addToInventory(name, image) {
            const exists = inventory.some(item => item.name === name);
            if (!exists) {
                inventory.push({ name, image, date: new Date(), id: Date.now() });
            }
        }

        function updateInventoryDisplay() {
            const grid = document.getElementById('inventoryGrid');
            if (inventory.length === 0) {
                grid.innerHTML = `
                    <div class="empty-message">
                        <img src="images/empty.png" alt="Empty" class="empty-img">
                        <p>No produce scanned yet</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = inventory.map(item => `
                <div class="inventory-item" onclick="showInfoModal('${item.name}', '${item.image}')">
                    <button class="remove-item-btn" onclick="event.stopPropagation(); removeFromInventory(${item.id})">‚úï</button>
                    <img src="${item.image}" alt="${item.name}" class="inventory-img">
                    <p class="inventory-name">${item.name}</p>
                    <p class="inventory-date">${item.date.toLocaleDateString()}</p>
                </div>
            `).join('');
        }

        function removeFromInventory(id) {
            if (confirm('Remove this item from inventory?')) {
                inventory = inventory.filter(item => item.id !== id);
                updateInventoryDisplay();
            }
        }

        // Enter key support
        document.getElementById('pluInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitPLU();
        });

        document.getElementById('scannerPLU')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitScannerPLU();
        });
    </script>
</body>
</html>