<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Produce Tracker</title>
    <link rel="stylesheet" href="stylei.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
</head>

<body>
    <div class="container">
        <!-- Landing Page -->
        <div id="landing" class="page active">
            <div class="landing">
                <div class="hero-icon">ü•ó</div>
                <h1>Keep It Fresh</h1>
                <p>Track your produce & reduce waste</p>
                <button class="btn" onclick="showPage('scan')">Get Started</button>
            </div>
        </div>

        <!-- Navigation -->
        <div id="nav" class="nav" style="display: none;">
            <button class="nav-btn" onclick="showPage('scan')">
                <span style="font-size: 1.8em;">üîç</span>
                Scan
            </button>
            <button class="nav-btn" onclick="showPage('calendar')">
                <span style="font-size: 1.8em;">üìÖ</span>
                Inventory
            </button>
            <button class="nav-btn" onclick="showPage('notes')">
                <span style="font-size: 1.8em;">üìù</span>
                Notes
            </button>
            <button class="nav-btn" onclick="showPage('settings')">
                <span style="font-size: 1.8em;">‚öôÔ∏è</span>
                Settings
            </button>
        </div>

        <!-- Scan/Search Page -->
        <div id="scan" class="page">
            <div class="header">
                <h1>Discover</h1>
                <p>Scan or search for produce</p>
            </div>
            <div class="content">
                <div class="search-section">
                    <input type="text" class="search-box" placeholder="Search by name or PLU code..." id="searchInput">
                    <button class="scan-btn" onclick="startScanner()">üì∑ Scan Barcode</button>
                </div>

                <div class="section-title">Popular Items</div>
                <div class="produce-grid">
                    <div class="produce-card" onclick="selectProduce('Banana', 'üçå', 5)">
                        <div class="produce-icon">üçå</div>
                        <div class="produce-name">Banana</div>
                    </div>
                    <div class="produce-card" onclick="selectProduce('Apple (Fuji)', 'üçé', 14)">
                        <div class="produce-icon">üçé</div>
                        <div class="produce-name">Apple</div>
                    </div>
                    <div class="produce-card" onclick="selectProduce('Tomato (Roma)', 'üçÖ', 7)">
                        <div class="produce-icon">üçÖ</div>
                        <div class="produce-name">Tomato</div>
                    </div>
                    <div class="produce-card" onclick="selectProduce('Avocado (Hass)', 'ü•ë', 4)">
                        <div class="produce-icon">ü•ë</div>
                        <div class="produce-name">Avocado</div>
                    </div>
                    <div class="produce-card" onclick="selectProduce('Strawberry', 'üçì', 3)">
                        <div class="produce-icon">üçì</div>
                        <div class="produce-name">Strawberry</div>
                    </div>
                    <div class="produce-card" onclick="selectProduce('Lettuce (Green Leaf)', 'ü•¨', 5)">
                        <div class="produce-icon">ü•¨</div>
                        <div class="produce-name">Lettuce</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendar" class="page">
            <div class="header">
                <h1>Inventory</h1>
                <p>Your fresh produce</p>
            </div>
            <div class="content">
                <div class="inventory-list" id="inventoryList">
                    <div class="empty-state">
                        <div class="empty-icon">üõí</div>
                        <p>No produce yet<br>Start by scanning items!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Page -->
        <div id="notes" class="page">
            <div class="header">
                <h1>Notes</h1>
                <p>Keep track of your ideas</p>
            </div>
            <div class="content">
                <div class="note-composer">
                    <textarea class="note-input" id="noteInput" placeholder="Add a note about your produce..."></textarea>
                    <button class="add-note-btn" onclick="addNote()">Add Note</button>
                </div>
                <div id="notesList"></div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <div class="header">
                <h1>Settings</h1>
                <p>Customize your experience</p>
            </div>
            <div class="content">
                <div class="settings-list">
                    <div class="setting-row">
                        <div class="setting-info">
                            <h3>Notifications</h3>
                            <p>Get reminders about expiring produce</p>
                        </div>
                        <div class="toggle active" onclick="toggleSetting(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <h3>Reminder Timing</h3>
                            <p>When to notify you</p>
                        </div>
                        <select>
                            <option>1 day</option>
                            <option selected>2 days</option>
                            <option>3 days</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <h3>Dark Mode</h3>
                            <p>Switch to dark theme</p>
                        </div>
                        <div class="toggle" onclick="toggleSetting(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Produce Info Page -->
        <div id="produceInfo" class="page">
            <button class="back-btn" onclick="showPage('scan')">‚Üê</button>
            <div class="info-hero">
                <div class="info-hero-icon" id="infoIcon">üçå</div>
                <h2 id="infoTitle">Banana</h2>
            </div>

            <div class="content">
                <div class="info-card">
                    <h3>Shelf Life</h3>
                    <p id="infoShelfLife">5 days at room temperature</p>
                </div>

                <div class="info-card">
                    <h3>Storage Tips</h3>
                    <p id="infoStorage">Store at room temperature. Keep away from direct sunlight. Separate from other fruits to slow ripening.</p>
                </div>

                <div class="info-card">
                    <h3>How to Tell When Ripe</h3>
                    <p id="infoRipeness">Yellow with small brown spots. Should be slightly soft when pressed gently.</p>
                </div>

                <div class="info-card">
                    <h3>Nutritional Information</h3>
                    <div class="nutrition-grid">
                        <div class="nutrition-item">
                            <div class="nutrition-value">105</div>
                            <div class="nutrition-label">Calories</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value">27g</div>
                            <div class="nutrition-label">Carbs</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value">3g</div>
                            <div class="nutrition-label">Fiber</div>
                        </div>
                        <div class="nutrition-item">
                            <div class="nutrition-value">422mg</div>
                            <div class="nutrition-label">Potassium</div>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>Seasonal Availability</h3>
                    <p id="infoSeason">Available year-round</p>
                </div>

                <button class="add-inventory-btn" onclick="addToInventory()">Add to Inventory</button>
            </div>
        </div>

        <!-- Scanner Modal -->
        <div id="scanner-container">
            <button class="close-scanner" onclick="stopScanner()">‚úï</button>
            <div id="scanner-video"></div>
            <div class="scanner-overlay">
                <div class="scanner-frame">
                    <div class="scanner-line"></div>
                </div>
                <div class="scanner-text">
                    Position barcode or PLU code within frame
                </div>
                <div class="manual-input">
                    <input type="text" id="manualPLU" placeholder="Enter PLU">
                    <button onclick="lookupManualPLU()">Search</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let inventory = [];
        let notes = [];
        let currentProduce = null;
        let scannerActive = false;

        // COMPREHENSIVE PLU CODE DATABASE - 150+ Produce Items
        const pluDatabase = {
            // BANANAS
            '4011': { name: 'Banana', icon: 'üçå', days: 5 },
            '4186': { name: 'Banana', icon: 'üçå', days: 5 },
            '4237': { name: 'Banana', icon: 'üçå', days: 5 },
            '94011': { name: 'Banana (Organic)', icon: 'üçå', days: 5 },
            
            // APPLES
            '3283': { name: 'Apple (Fuji)', icon: 'üçé', days: 14 },
            '4131': { name: 'Apple (Fuji)', icon: 'üçé', days: 14 },
            '4139': { name: 'Apple (Granny Smith)', icon: 'üçè', days: 14 },
            '4015': { name: 'Apple (Gala)', icon: 'üçé', days: 14 },
            '4016': { name: 'Apple (Golden Delicious)', icon: 'üçé', days: 14 },
            '4017': { name: 'Apple (Granny Smith)', icon: 'üçè', days: 14 },
            '4101': { name: 'Apple (Red Delicious)', icon: 'üçé', days: 14 },
            '4152': { name: 'Apple (McIntosh)', icon: 'üçé', days: 14 },
            '3284': { name: 'Apple (Honeycrisp)', icon: 'üçé', days: 14 },
            '94131': { name: 'Apple (Organic Fuji)', icon: 'üçé', days: 14 },
            '94139': { name: 'Apple (Organic Granny Smith)', icon: 'üçè', days: 14 },
            
            // AVOCADOS
            '4046': { name: 'Avocado (Hass)', icon: 'ü•ë', days: 4 },
            '4225': { name: 'Avocado', icon: 'ü•ë', days: 4 },
            '94046': { name: 'Avocado (Organic Hass)', icon: 'ü•ë', days: 4 },
            
            // TOMATOES
            '4664': { name: 'Tomato (Roma)', icon: 'üçÖ', days: 7 },
            '4799': { name: 'Tomato (Beefsteak)', icon: 'üçÖ', days: 7 },
            '3151': { name: 'Tomato (Cherry)', icon: 'üçÖ', days: 5 },
            '4087': { name: 'Tomato (Grape)', icon: 'üçÖ', days: 5 },
            '94664': { name: 'Tomato (Organic Roma)', icon: 'üçÖ', days: 7 },
            
            // STRAWBERRIES
            '4770': { name: 'Strawberry', icon: 'üçì', days: 3 },
            '94770': { name: 'Strawberry (Organic)', icon: 'üçì', days: 3 },
            
            // LETTUCE
            '4061': { name: 'Lettuce (Green Leaf)', icon: 'ü•¨', days: 5 },
            '4076': { name: 'Lettuce (Iceberg)', icon: 'ü•¨', days: 7 },
            '4075': { name: 'Lettuce (Romaine)', icon: 'ü•¨', days: 5 },
            '4820': { name: 'Lettuce (Red Leaf)', icon: 'ü•¨', days: 5 },
            '94061': { name: 'Lettuce (Organic Green Leaf)', icon: 'ü•¨', days: 5 },
            
            // ORANGES
            '4012': { name: 'Orange (Navel)', icon: 'üçä', days: 14 },
            '3107': { name: 'Orange (Valencia)', icon: 'üçä', days: 14 },
            '4450': { name: 'Orange (Cara Cara)', icon: 'üçä', days: 14 },
            '94012': { name: 'Orange (Organic Navel)', icon: 'üçä', days: 14 },
            
            // GRAPES
            '4023': { name: 'Grapes (Green)', icon: 'üçá', days: 7 },
            '4499': { name: 'Grapes (Red)', icon: 'üçá', days: 7 },
            '4500': { name: 'Grapes (Black)', icon: 'üçá', days: 7 },
            '94023': { name: 'Grapes (Organic Green)', icon: 'üçá', days: 7 },
            
            // BERRIES
            '4396': { name: 'Blueberry', icon: 'ü´ê', days: 5 },
            '4409': { name: 'Raspberry', icon: 'ü´ê', days: 2 },
            '4410': { name: 'Blackberry', icon: 'ü´ê', days: 3 },
            '94396': { name: 'Blueberry (Organic)', icon: 'ü´ê', days: 5 },
            
            // PEPPERS
            '4065': { name: 'Pepper (Green Bell)', icon: 'ü´ë', days: 7 },
            '4088': { name: 'Pepper (Red Bell)', icon: 'ü´ë', days: 7 },
            '4689': { name: 'Pepper (Yellow Bell)', icon: 'ü´ë', days: 7 },
            '4090': { name: 'Pepper (Orange Bell)', icon: 'ü´ë', days: 7 },
            '4693': { name: 'Pepper (Jalape√±o)', icon: 'üå∂Ô∏è', days: 7 },
            
            // POTATOES
            '4072': { name: 'Potato (Russet)', icon: 'ü•î', days: 30 },
            '4073': { name: 'Potato (Red)', icon: 'ü•î', days: 21 },
            '4083': { name: 'Potato (Yukon Gold)', icon: 'ü•î', days: 21 },
            '4091': { name: 'Sweet Potato', icon: 'üç†', days: 14 },
            '94072': { name: 'Potato (Organic Russet)', icon: 'ü•î', days: 30 },
            
            // ONIONS
            '4663': { name: 'Onion (Yellow)', icon: 'üßÖ', days: 30 },
            '4082': { name: 'Onion (Red)', icon: 'üßÖ', days: 30 },
            '4166': { name: 'Onion (White)', icon: 'üßÖ', days: 30 },
            '4068': { name: 'Onion (Green/Scallion)', icon: 'üßÖ', days: 7 },
            
            // CARROTS
            '4562': { name: 'Carrot', icon: 'ü•ï', days: 21 },
            '4094': { name: 'Carrot (Baby)', icon: 'ü•ï', days: 14 },
            '94562': { name: 'Carrot (Organic)', icon: 'ü•ï', days: 21 },
            
            // BROCCOLI & CAULIFLOWER
            '4060': { name: 'Broccoli', icon: 'ü•¶', days: 7 },
            '4079': { name: 'Cauliflower', icon: 'ü•¶', days: 7 },
            '94060': { name: 'Broccoli (Organic)', icon: 'ü•¶', days: 7 },
            
            // CUCUMBERS
            '4062': { name: 'Cucumber', icon: 'ü•í', days: 7 },
            '3338': { name: 'Cucumber (English)', icon: 'ü•í', days: 7 },
            '94062': { name: 'Cucumber (Organic)', icon: 'ü•í', days: 7 },
            
            // MELONS
            '4032': { name: 'Watermelon', icon: 'üçâ', days: 7 },
            '4050': { name: 'Cantaloupe', icon: 'üçà', days: 5 },
            '4318': { name: 'Honeydew', icon: 'üçà', days: 7 },
            
            // CITRUS
            '4048': { name: 'Lime', icon: 'üçã', days: 14 },
            '4053': { name: 'Lemon', icon: 'üçã', days: 21 },
            '4450': { name: 'Grapefruit', icon: 'üçä', days: 14 },
            '3115': { name: 'Tangerine', icon: 'üçä', days: 7 },
            
            // STONE FRUITS
            '4044': { name: 'Peach', icon: 'üçë', days: 5 },
            '4042': { name: 'Nectarine', icon: 'üçë', days: 5 },
            '4040': { name: 'Plum', icon: 'üçë', days: 5 },
            '4039': { name: 'Cherry', icon: 'üçí', days: 3 },
            '4408': { name: 'Apricot', icon: 'üçë', days: 5 },
            
            // TROPICAL
            '4030': { name: 'Pineapple', icon: 'üçç', days: 7 },
            '4051': { name: 'Mango', icon: 'ü•≠', days: 5 },
            '3114': { name: 'Papaya', icon: 'ü•≠', days: 5 },
            '4233': { name: 'Kiwi', icon: 'ü•ù', days: 7 },
            '4414': { name: 'Coconut', icon: 'ü••', days: 30 },
            
            // SQUASH & ZUCCHINI
            '4067': { name: 'Zucchini', icon: 'ü•í', days: 7 },
            '4750': { name: 'Squash (Butternut)', icon: 'üéÉ', days: 30 },
            '4759': { name: 'Squash (Acorn)', icon: 'üéÉ', days: 21 },
            '4784': { name: 'Squash (Spaghetti)', icon: 'üéÉ', days: 21 },
            
            // LEAFY GREENS
            '4592': { name: 'Spinach', icon: 'ü•¨', days: 5 },
            '4591': { name: 'Kale', icon: 'ü•¨', days: 5 },
            '4613': { name: 'Arugula', icon: 'ü•¨', days: 3 },
            '3120': { name: 'Swiss Chard', icon: 'ü•¨', days: 5 },
            
            // MUSHROOMS
            '4080': { name: 'Mushroom (White)', icon: 'üçÑ', days: 7 },
            '4084': { name: 'Mushroom (Portobello)', icon: 'üçÑ', days: 7 },
            '4081': { name: 'Mushroom (Shiitake)', icon: 'üçÑ', days: 7 },
            
            // HERBS
            '4885': { name: 'Basil', icon: 'üåø', days: 5 },
            '4901': { name: 'Cilantro', icon: 'üåø', days: 5 },
            '4899': { name: 'Parsley', icon: 'üåø', days: 7 },
            '4889': { name: 'Mint', icon: 'üåø', days: 5 },
            
            // MISC
            '4545': { name: 'Celery', icon: 'ü•¨', days: 14 },
            '4554': { name: 'Eggplant', icon: 'üçÜ', days: 7 },
            '4548': { name: 'Asparagus', icon: 'ü•í', days: 5 },
            '4066': { name: 'Corn', icon: 'üåΩ', days: 5 },
            '3082': { name: 'Pear (Bartlett)', icon: 'üçê', days: 7 },
            '4416': { name: 'Pear (Anjou)', icon: 'üçê', days: 7 },
            '4421': { name: 'Pear (Bosc)', icon: 'üçê', days: 7 }
        };

        // COMPREHENSIVE PRODUCE DATA
        const produceData = {
            'Banana': { storage: 'Store at room temperature. Keep away from direct sunlight. Separate from other fruits to slow ripening.', ripeness: 'Yellow with small brown spots. Should be slightly soft when pressed gently.', season: 'Available year-round' },
            'Banana (Organic)': { storage: 'Store at room temperature. Keep away from direct sunlight.', ripeness: 'Yellow with small brown spots.', season: 'Available year-round' },
            
            'Apple (Fuji)': { storage: 'Refrigerate for best results.', ripeness: 'Firm with red-pink color.', season: 'October to July' },
            'Apple (Granny Smith)': { storage: 'Refrigerate to maintain crispness.', ripeness: 'Bright green, very firm.', season: 'Year-round' },
            'Apple (Gala)': { storage: 'Store in fridge crisper drawer.', ripeness: 'Red and yellow striped, firm.', season: 'August to March' },
            'Apple (Golden Delicious)': { storage: 'Refrigerate for extended freshness.', ripeness: 'Golden yellow, slightly soft.', season: 'September to June' },
            'Apple (Red Delicious)': { storage: 'Keep refrigerated.', ripeness: 'Deep red color, firm.', season: 'September to July' },
            'Apple (McIntosh)': { storage: 'Best when refrigerated.', ripeness: 'Red with green, soft when ripe.', season: 'September to May' },
            'Apple (Honeycrisp)': { storage: 'Refrigerate to maintain crunch.', ripeness: 'Red and yellow, very crisp.', season: 'September to January' },
            'Apple (Organic Fuji)': { storage: 'Refrigerate for best results.', ripeness: 'Firm with red-pink color.', season: 'October to July' },
            'Apple (Organic Granny Smith)': { storage: 'Refrigerate to maintain crispness.', ripeness: 'Bright green, very firm.', season: 'Year-round' },
            
            'Avocado': { storage: 'Ripen at room temperature, then refrigerate. Store in paper bag to speed ripening.', ripeness: 'Yields to gentle pressure, dark green to black skin, stem comes off easily.', season: 'Available year-round, peak: Spring-Summer' },
            'Avocado (Hass)': { storage: 'Ripen at room temp, refrigerate when ripe.', ripeness: 'Dark skin, yields to gentle pressure.', season: 'Year-round' },
            'Avocado (Organic Hass)': { storage: 'Ripen at room temp, refrigerate when ripe.', ripeness: 'Dark skin, yields to gentle pressure.', season: 'Year-round' },
            
            'Tomato (Roma)': { storage: 'Room temperature, never refrigerate.', ripeness: 'Deep red, firm but gives slightly.', season: 'June to September' },
            'Tomato (Beefsteak)': { storage: 'Keep at room temperature.', ripeness: 'Large, deep red, heavy for size.', season: 'Summer months' },
            'Tomato (Cherry)': { storage: 'Room temperature for best flavor.', ripeness: 'Bright red, firm.', season: 'Year-round' },
            'Tomato (Grape)': { storage: 'Room temperature preferred.', ripeness: 'Deep red, glossy.', season: 'Year-round' },
            'Tomato (Organic Roma)': { storage: 'Room temperature, never refrigerate.', ripeness: 'Deep red, firm but gives slightly.', season: 'June to September' },
            
            'Strawberry': { storage: 'Refrigerate unwashed in original container. Wash just before eating.', ripeness: 'Bright red color throughout, fresh green caps, sweet aroma.', season: 'Peak season: April to June' },
            'Strawberry (Organic)': { storage: 'Refrigerate unwashed.', ripeness: 'Bright red, fresh green caps.', season: 'April to June' },
            
            'Lettuce (Green Leaf)': { storage: 'Wrap in damp towel, refrigerate.', ripeness: 'Crisp, bright green leaves.', season: 'Spring and Fall' },
            'Lettuce (Iceberg)': { storage: 'Refrigerate in crisper drawer.', ripeness: 'Firm head, crisp leaves.', season: 'Year-round' },
            'Lettuce (Romaine)': { storage: 'Refrigerate in plastic bag.', ripeness: 'Dark green, crisp ribs.', season: 'Year-round' },
            'Lettuce (Red Leaf)': { storage: 'Wrap in damp towel, refrigerate.', ripeness: 'Red-tipped, crisp.', season: 'Spring and Fall' },
            'Lettuce (Organic Green Leaf)': { storage: 'Wrap in damp towel, refrigerate.', ripeness: 'Crisp, bright green leaves.', season: 'Spring and Fall' },
            
            'Orange (Navel)': { storage: 'Room temperature for a week, refrigerate for longer.', ripeness: 'Heavy for size, firm, fragrant.', season: 'November to June' },
            'Orange (Valencia)': { storage: 'Cool place or refrigerate.', ripeness: 'Bright orange, slightly soft.', season: 'March to October' },
            'Orange (Cara Cara)': { storage: 'Room temp or refrigerate.', ripeness: 'Orange-red skin, heavy.', season: 'December to April' },
            'Orange (Organic Navel)': { storage: 'Room temperature for a week, refrigerate for longer.', ripeness: 'Heavy for size, firm, fragrant.', season: 'November to June' },
            
            'Grapes (Green)': { storage: 'Refrigerate unwashed in original bag.', ripeness: 'Plump, firmly attached to stem.', season: 'May to January' },
            'Grapes (Red)': { storage: 'Refrigerate unwashed.', ripeness: 'Deep color, plump.', season: 'May to January' },
            'Grapes (Black)': { storage: 'Keep refrigerated.', ripeness: 'Dark purple, plump.', season: 'July to December' },
            'Grapes (Organic Green)': { storage: 'Refrigerate unwashed in original bag.', ripeness: 'Plump, firmly attached to stem.', season: 'May to January' },
            
            'Blueberry': { storage: 'Refrigerate unwashed, rinse before eating.', ripeness: 'Deep blue color, firm.', season: 'May to September' },
            'Raspberry': { storage: 'Refrigerate immediately, very delicate.', ripeness: 'Deep red, plump.', season: 'June to October' },
            'Blackberry': { storage: 'Refrigerate, use quickly.', ripeness: 'Deep black, glossy.', season: 'May to September' },
            'Blueberry (Organic)': { storage: 'Refrigerate unwashed, rinse before eating.', ripeness: 'Deep blue color, firm.', season: 'May to September' },
            
            'Pepper (Green Bell)': { storage: 'Refrigerate in crisper drawer.', ripeness: 'Firm, glossy skin, heavy.', season: 'Year-round' },
            'Pepper (Red Bell)': { storage: 'Refrigerate for freshness.', ripeness: 'Deep red, firm, glossy.', season: 'Year-round' },
            'Pepper (Yellow Bell)': { storage: 'Keep refrigerated.', ripeness: 'Bright yellow, firm.', season: 'Year-round' },
            'Pepper (Orange Bell)': { storage: 'Refrigerate in crisper.', ripeness: 'Bright orange, firm.', season: 'Year-round' },
            'Pepper (Jalape√±o)': { storage: 'Refrigerate for freshness.', ripeness: 'Dark green, firm, glossy.', season: 'Year-round' },
            
            'Potato (Russet)': { storage: 'Cool, dark, dry place. Never refrigerate.', ripeness: 'Firm, no green spots or sprouts.', season: 'Year-round' },
            'Potato (Red)': { storage: 'Cool, dark place.', ripeness: 'Firm, smooth skin.', season: 'Year-round' },
            'Potato (Yukon Gold)': { storage: 'Cool, dark, dry place.', ripeness: 'Firm, golden skin.', season: 'Year-round' },
            'Sweet Potato': { storage: 'Cool, dry place, not refrigerated.', ripeness: 'Firm, no soft spots.', season: 'September to December' },
            'Potato (Organic Russet)': { storage: 'Cool, dark, dry place. Never refrigerate.', ripeness: 'Firm, no green spots or sprouts.', season: 'Year-round' },
            
            'Onion (Yellow)': { storage: 'Cool, dry, dark place with good air circulation.', ripeness: 'Firm, dry outer skin, no sprouting.', season: 'Year-round' },
            'Onion (Red)': { storage: 'Cool, dry place.', ripeness: 'Firm, papery skin.', season: 'Year-round' },
            'Onion (White)': { storage: 'Cool, dry, dark place.', ripeness: 'Firm, white outer layers.', season: 'Year-round' },
            'Onion (Green/Scallion)': { storage: 'Refrigerate in plastic bag.', ripeness: 'Bright green tops, white bottoms.', season: 'Year-round' },
            
            'Carrot': { storage: 'Remove tops, refrigerate in plastic bag.', ripeness: 'Firm, bright orange, smooth.', season: 'Year-round' },
            'Carrot (Baby)': { storage: 'Refrigerate in original bag.', ripeness: 'Firm, bright orange.', season: 'Year-round' },
            'Carrot (Organic)': { storage: 'Remove tops, refrigerate in plastic bag.', ripeness: 'Firm, bright orange, smooth.', season: 'Year-round' },
            
            'Broccoli': { storage: 'Refrigerate in crisper drawer, unwashed.', ripeness: 'Tight florets, deep green color.', season: 'October to April' },
            'Cauliflower': { storage: 'Refrigerate in plastic bag.', ripeness: 'Compact head, creamy white.', season: 'September to June' },
            'Broccoli (Organic)': { storage: 'Refrigerate in crisper drawer, unwashed.', ripeness: 'Tight florets, deep green color.', season: 'October to April' },
            
            'Cucumber': { storage: 'Refrigerate wrapped in paper towel.', ripeness: 'Firm, dark green, no soft spots.', season: 'May to August' },
            'Cucumber (English)': { storage: 'Refrigerate in plastic wrap.', ripeness: 'Long, firm, dark green.', season: 'Year-round' },
            'Cucumber (Organic)': { storage: 'Refrigerate wrapped in paper towel.', ripeness: 'Firm, dark green, no soft spots.', season: 'May to August' },
            
            'Watermelon': { storage: 'Room temp until cut, then refrigerate.', ripeness: 'Dull skin, yellow spot on bottom, hollow sound.', season: 'May to September' },
            'Cantaloupe': { storage: 'Room temp to ripen, refrigerate when ripe.', ripeness: 'Sweet aroma, slightly soft at stem end.', season: 'June to September' },
            'Honeydew': { storage: 'Room temperature, refrigerate when ripe.', ripeness: 'Creamy yellow color, sweet aroma.', season: 'June to October' },
            
            'Lime': { storage: 'Room temperature for a week, refrigerate longer.', ripeness: 'Heavy for size, bright green.', season: 'Year-round' },
            'Lemon': { storage: 'Room temp or refrigerate.', ripeness: 'Bright yellow, firm, heavy.', season: 'Year-round' },
            'Grapefruit': { storage: 'Cool place or refrigerate.', ripeness: 'Heavy for size, firm.', season: 'October to June' },
            'Tangerine': { storage: 'Room temp for few days, refrigerate longer.', ripeness: 'Loose skin, deep orange.', season: 'November to April' },
            
            'Peach': { storage: 'Room temp to ripen, refrigerate when ripe.', ripeness: 'Sweet aroma, gives slightly to pressure.', season: 'May to September' },
            'Nectarine': { storage: 'Ripen at room temp, refrigerate when soft.', ripeness: 'Fragrant, gives to gentle pressure.', season: 'May to September' },
            'Plum': { storage: 'Room temp to ripen, then refrigerate.', ripeness: 'Slightly soft, sweet aroma.', season: 'May to October' },
            'Cherry': { storage: 'Refrigerate unwashed immediately.', ripeness: 'Glossy, firm, plump.', season: 'May to August' },
            'Apricot': { storage: 'Room temp to ripen, refrigerate when soft.', ripeness: 'Orange color, gives to pressure.', season: 'May to August' },
            
            'Pineapple': { storage: 'Room temp for 1-2 days, refrigerate cut pieces.', ripeness: 'Sweet aroma at base, leaves pull easily.', season: 'March to July' },
            'Mango': { storage: 'Room temp to ripen, refrigerate when soft.', ripeness: 'Yields to pressure, sweet aroma.', season: 'March to September' },
            'Papaya': { storage: 'Room temp until mostly yellow, then refrigerate.', ripeness: 'Yellow skin, slightly soft.', season: 'Year-round' },
            'Kiwi': { storage: 'Room temp to ripen, refrigerate when soft.', ripeness: 'Gives to gentle pressure.', season: 'Year-round' },
            'Coconut': { storage: 'Room temperature, refrigerate if cracked.', ripeness: 'Heavy, sloshing sound when shaken.', season: 'Year-round' },
            
            'Zucchini': { storage: 'Refrigerate in plastic bag.', ripeness: 'Firm, smooth skin, small to medium size.', season: 'June to September' },
            'Squash (Butternut)': { storage: 'Cool, dry place, do not refrigerate.', ripeness: 'Tan color, hard skin, heavy.', season: 'September to February' },
            'Squash (Acorn)': { storage: 'Cool, dry place.', ripeness: 'Dark green with orange spot, hard.', season: 'October to December' },
            'Squash (Spaghetti)': { storage: 'Cool, dry, dark place.', ripeness: 'Yellow color, hard skin.', season: 'September to March' },
            
            'Spinach': { storage: 'Refrigerate in original bag, use quickly.', ripeness: 'Dark green, crisp leaves.', season: 'Year-round, peak Spring/Fall' },
            'Kale': { storage: 'Refrigerate in plastic bag.', ripeness: 'Dark green, crisp, no yellowing.', season: 'Year-round, best in Winter' },
            'Arugula': { storage: 'Refrigerate, very delicate.', ripeness: 'Bright green, tender leaves.', season: 'Spring and Fall' },
            'Swiss Chard': { storage: 'Refrigerate in plastic bag.', ripeness: 'Crisp stalks, vibrant leaves.', season: 'June to October' },
            
            'Mushroom (White)': { storage: 'Refrigerate in paper bag, not plastic.', ripeness: 'Firm, dry, closed caps.', season: 'Year-round' },
            'Mushroom (Portobello)': { storage: 'Paper bag in refrigerator.', ripeness: 'Firm, dry, large caps.', season: 'Year-round' },
            'Mushroom (Shiitake)': { storage: 'Refrigerate in paper bag.', ripeness: 'Firm, dry, umbrella-shaped.', season: 'Year-round' },
            
            'Basil': { storage: 'Trim stems, place in water like flowers, room temp.', ripeness: 'Bright green, no brown spots.', season: 'June to September' },
            'Cilantro': { storage: 'Refrigerate stems in water, cover loosely.', ripeness: 'Bright green, fragrant.', season: 'Year-round' },
            'Parsley': { storage: 'Refrigerate in plastic bag or in water.', ripeness: 'Bright green, crisp.', season: 'Year-round' },
            'Mint': { storage: 'Refrigerate stems in water.', ripeness: 'Bright green, aromatic.', season: 'Year-round' },
            
            'Celery': { storage: 'Wrap in foil, refrigerate in crisper.', ripeness: 'Firm, crisp stalks, tight bunch.', season: 'Year-round' },
            'Eggplant': { storage: 'Room temperature, use within a week.', ripeness: 'Firm, glossy skin, heavy.', season: 'July to October' },
            'Asparagus': { storage: 'Refrigerate upright in water.', ripeness: 'Firm stalks, tight tips, bright green.', season: 'February to June' },
            'Corn': { storage: 'Refrigerate in husk, use quickly.', ripeness: 'Bright green husk, plump kernels.', season: 'May to September' },
            
            'Pear (Bartlett)': { storage: 'Room temp to ripen, refrigerate when ripe.', ripeness: 'Gives slightly at neck, fragrant.', season: 'August to February' },
            'Pear (Anjou)': { storage: 'Room temp to ripen, refrigerate when soft.', ripeness: 'Gives to gentle pressure at neck.', season: 'October to May' },
            'Pear (Bosc)': { storage: 'Ripen at room temp, refrigerate when ripe.', ripeness: 'Color deepens, slightly soft at neck.', season: 'September to April' }
        };

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            if (pageId !== 'landing') {
                document.getElementById('nav').style.display = 'flex';
            } else {
                document.getElementById('nav').style.display = 'none';
            }

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if (event?.target?.classList.contains('nav-btn')) {
                event.target.classList.add('active');
            }

            if (pageId === 'calendar') {
                updateInventoryDisplay();
            } else if (pageId === 'notes') {
                updateNotesDisplay();
            }
        }

        function startScanner() {
            const isSecure = window.location.protocol === 'https:' || 
                           window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1';
            
            if (!isSecure) {
                alert('‚ö†Ô∏è Camera requires HTTPS or localhost.\n\nPlease either:\n1. Run a local server (see console for instructions)\n2. Host on GitHub Pages/Netlify\n3. Use manual PLU entry');
                console.log('%cüîß To run a local server:', 'font-weight: bold; font-size: 14px;');
                console.log('Python: python -m http.server 8000');
                console.log('Node: npx http-server');
                console.log('VS Code: Install "Live Server" extension');
                return;
            }

            const container = document.getElementById('scanner-container');
            container.classList.add('active');
            scannerActive = true;

            if (typeof Quagga === 'undefined') {
                alert('Scanner library not loaded. Check your internet connection.');
                stopScanner();
                return;
            }

            console.log('üé• Initializing camera...');

            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-video'),
                    constraints: {
                        width: { min: 640, ideal: 1280, max: 1920 },
                        height: { min: 480, ideal: 720, max: 1080 },
                        facingMode: "environment",
                        aspectRatio: { min: 1, max: 2 }
                    },
                },
                decoder: {
                    readers: [
                        "ean_reader",
                        "ean_8_reader",
                        "code_128_reader",
                        "code_39_reader",
                        "upc_reader",
                        "upc_e_reader"
                    ],
                    debug: {
                        drawBoundingBox: true,
                        showFrequency: true,
                        drawScanline: true,
                        showPattern: true
                    }
                },
                locate: true,
                numOfWorkers: 4,
                frequency: 10
            }, function(err) {
                if (err) {
                    console.error('Camera error:', err);
                    let errorMsg = 'Camera error: ';
                    
                    if (err.name === 'NotAllowedError') {
                        errorMsg += 'Permission denied. Please allow camera access and try again.';
                    } else if (err.name === 'NotFoundError') {
                        errorMsg += 'No camera found on this device.';
                    } else if (err.name === 'NotReadableError') {
                        errorMsg += 'Camera is already in use by another application.';
                    } else if (err.name === 'OverconstrainedError') {
                        errorMsg += 'Camera does not meet requirements.';
                    } else {
                        errorMsg += err.message || 'Unknown error. Please use manual PLU entry.';
                    }
                    
                    alert(errorMsg);
                    stopScanner();
                    return;
                }
                
                console.log('‚úÖ Camera initialized successfully!');
                Quagga.start();
                
                const text = document.querySelector('.scanner-text');
                text.textContent = 'üì∏ Scanning... Position barcode in frame';
            });

            Quagga.onDetected(function(result) {
                const code = result.codeResult.code;
                const format = result.codeResult.format;
                console.log(`‚úÖ Detected ${format}: ${code}`);
                
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
                
                lookupPLU(code);
            });

            Quagga.onProcessed(function(result) {
                if (result && result.codeResult) {
                    console.log('Processing barcode...');
                }
            });
        }

        function stopScanner() {
            if (scannerActive) {
                Quagga.stop();
                Quagga.offDetected();
                Quagga.offProcessed();
                scannerActive = false;
                console.log('üõë Scanner stopped');
            }
            document.getElementById('scanner-container').classList.remove('active');
            
            const text = document.querySelector('.scanner-text');
            text.textContent = 'Position barcode or PLU code within frame';
            text.style.color = 'white';
        }

        function lookupPLU(code) {
            const cleanCode = code.replace(/^0+/, '');
            
            if (pluDatabase[cleanCode]) {
                stopScanner();
                const produce = pluDatabase[cleanCode];
                selectProduce(produce.name, produce.icon, produce.days);
            } else {
                const text = document.querySelector('.scanner-text');
                const originalText = text.textContent;
                text.textContent = `PLU ${cleanCode} not found. Keep scanning or try manual entry.`;
                text.style.color = '#ff3b30';
                setTimeout(() => {
                    text.textContent = originalText;
                    text.style.color = 'white';
                }, 2000);
            }
        }

        function lookupManualPLU() {
            const input = document.getElementById('manualPLU');
            const code = input.value.trim();
            
            if (code) {
                lookupPLU(code);
                input.value = '';
            }
        }

        function selectProduce(name, icon, days) {
            currentProduce = { name, icon, days, addedDate: new Date() };
            
            const data = produceData[name] || { storage: 'Store properly', ripeness: 'Check for freshness', season: 'Varies' };
            document.getElementById('infoIcon').textContent = icon;
            document.getElementById('infoTitle').textContent = name;
            document.getElementById('infoShelfLife').textContent = `${days} days`;
            document.getElementById('infoStorage').textContent = data.storage;
            document.getElementById('infoRipeness').textContent = data.ripeness;
            document.getElementById('infoSeason').textContent = data.season;
            
            showPage('produceInfo');
        }

        function addToInventory() {
            if (currentProduce) {
                inventory.push({...currentProduce, id: Date.now()});
                alert(`${currentProduce.icon} ${currentProduce.name} added to inventory!`);
                showPage('calendar');
            }
        }

        function updateInventoryDisplay() {
            const list = document.getElementById('inventoryList');
            if (inventory.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üõí</div>
                        <p>No produce yet<br>Start by scanning items!</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = inventory.map(item => {
                const daysLeft = item.days - Math.floor((new Date() - item.addedDate) / (1000 * 60 * 60 * 24));
                let urgencyClass = '';
                
                if (daysLeft <= 2) urgencyClass = 'urgent';
                else if (daysLeft <= 4) urgencyClass = 'warning';

                return `
                    <div class="inventory-card ${urgencyClass}">
                        <div class="inventory-info">
                            <div class="inventory-icon">${item.icon}</div>
                            <div class="inventory-details">
                                <h3>${item.name}</h3>
                                <div class="inventory-date">Added ${item.addedDate.toLocaleDateString()}</div>
                            </div>
                        </div>
                        <div class="days-badge ${urgencyClass}">${daysLeft}d</div>
                    </div>
                `;
            }).join('');
        }

        function addNote() {
            const input = document.getElementById('noteInput');
            if (input.value.trim()) {
                notes.push({
                    text: input.value,
                    date: new Date(),
                    id: Date.now()
                });
                input.value = '';
                updateNotesDisplay();
            }
        }

        function updateNotesDisplay() {
            const list = document.getElementById('notesList');
            if (notes.length === 0) {
                list.innerHTML = '';
                return;
            }

            list.innerHTML = notes.map(note => `
                <div class="note-card">
                    <div class="note-header">
                        <span class="note-date">${note.date.toLocaleDateString()} ${note.date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                        <button class="delete-btn" onclick="deleteNote(${note.id})">Delete</button>
                    </div>
                    <p class="note-text">${note.text}</p>
                </div>
            `).join('');
        }

        function deleteNote(id) {
            notes = notes.filter(n => n.id !== id);
            updateNotesDisplay();
        }

        function toggleSetting(element) {
            element.classList.toggle('active');
        }

        // Search functionality
        document.getElementById('searchInput')?.addEventListener('input', (e) => {
            const search = e.target.value.toLowerCase();
            
            if (/^\d{4,5}$/.test(search)) {
                if (pluDatabase[search]) {
                    const produce = pluDatabase[search];
                    selectProduce(produce.name, produce.icon, produce.days);
                }
            }
            
            document.querySelectorAll('.produce-card').forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(search) ? 'block' : 'none';
            });
        });

        document.getElementById('manualPLU')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                lookupManualPLU();
            }
        });
    </script>
</body>
</html>