<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produce Scanner</title>
    <link rel="stylesheet" href="stylei.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Landing/Scan Page -->
        <div id="landing" class="page active">
            <div class="landing">
                <div class="hero-icon">ü•ó</div>
                <h1>Produce Scanner</h1>
                <p>Scan to discover nutrition & seasonal info</p>
                
                <div class="scan-actions">
                    <button class="btn-primary" onclick="startScanner()">üì∑ Scan Barcode</button>
                    <div class="divider"><span>or</span></div>
                    <input type="text" class="plu-input" placeholder="Enter PLU code..." id="mainPLUInput">
                    <button class="btn-secondary" onclick="searchMainPLU()">Search</button>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div id="nav" class="nav" style="display: none;">
            <button class="nav-btn active" onclick="showPage('landing')">
                <span style="font-size: 1.8em;">üîç</span>
                Scan
            </button>
            <button class="nav-btn" onclick="showPage('inventory')">
                <span style="font-size: 1.8em;">üì¶</span>
                Collection
            </button>
            <button class="nav-btn" onclick="showPage('settings')">
                <span style="font-size: 1.8em;">‚öôÔ∏è</span>
                Settings
            </button>
        </div>

        <!-- Collection Page -->
        <div id="inventory" class="page">
            <div class="header">
                <h1>My Collection</h1>
                <p>Your scanned produce items</p>
            </div>
            <div class="content">
                <div class="collection-grid" id="collectionGrid">
                    <div class="empty-state">
                        <div class="empty-icon">üì¶</div>
                        <p>No items yet<br>Start by scanning produce!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <div class="header">
                <h1>Settings</h1>
                <p>Customize your experience</p>
            </div>
            <div class="content">
                <div class="settings-list">
                    <div class="setting-row">
                        <div class="setting-info">
                            <h3>Sound Effects</h3>
                            <p>Play sound when scanning</p>
                        </div>
                        <div class="toggle active" onclick="toggleSetting(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <h3>Vibration</h3>
                            <p>Haptic feedback on scan</p>
                        </div>
                        <div class="toggle active" onclick="toggleSetting(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <h3>Auto-Add to Collection</h3>
                            <p>Automatically save scanned items</p>
                        </div>
                        <div class="toggle" onclick="toggleSetting(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <h3>Clear Collection</h3>
                            <p>Remove all saved items</p>
                        </div>
                        <button class="clear-btn" onclick="clearCollection()">Clear All</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Produce Info Page -->
        <div id="produceInfo" class="page">
            <button class="back-btn" onclick="showPage('landing')">‚Üê</button>
            <div class="info-hero">
                <div class="info-hero-icon" id="infoIcon">üçå</div>
                <h2 id="infoTitle">Banana</h2>
            </div>

            <div class="content">
                <div class="info-card">
                    <h3>üåç Seasonal Availability</h3>
                    <p id="infoSeason">Available year-round</p>
                </div>

                <div class="info-card">
                    <h3>üì¶ Storage Tips</h3>
                    <p id="infoStorage">Store at room temperature.</p>
                </div>

                <div class="info-card">
                    <h3>‚ú® How to Tell When Ripe</h3>
                    <p id="infoRipeness">Yellow with small brown spots.</p>
                </div>

                <div class="info-card">
                    <h3>ü•ó Nutritional Information</h3>
                    <div class="nutrition-grid" id="nutritionGrid"></div>
                </div>

                <button class="add-collection-btn" onclick="addToCollection()">üíæ Add to Collection</button>
            </div>
        </div>

        <!-- Scanner Modal -->
        <div id="scanner-container">
            <button class="close-scanner" onclick="stopScanner()">‚úï</button>
            <div id="scanner-video"></div>
            <div class="scanner-overlay">
                <div class="scanner-frame">
                    <div class="scanner-line"></div>
                </div>
                <div class="scanner-text">Position barcode or PLU sticker within frame</div>
                <div class="manual-input">
                    <input type="text" id="manualPLU" placeholder="Enter PLU">
                    <button onclick="lookupManualPLU()">Search</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let collection = [];
        let currentProduce = null;
        let scannerActive = false;
        let autoAdd = false;

        // Load collection on page load
        window.addEventListener('load', () => {
            updateCollectionDisplay();
        });

        // PLU CODE DATABASE - 150+ Produce Items
        const pluDatabase = {
            '4011': { name: 'Banana', icon: 'üçå' },
            '4186': { name: 'Banana', icon: 'üçå' },
            '4237': { name: 'Banana', icon: 'üçå' },
            '94011': { name: 'Banana (Organic)', icon: 'üçå' },
            '3283': { name: 'Apple (Fuji)', icon: 'üçé' },
            '4131': { name: 'Apple (Fuji)', icon: 'üçé' },
            '4139': { name: 'Apple (Granny Smith)', icon: 'üçè' },
            '4015': { name: 'Apple (Gala)', icon: 'üçé' },
            '4016': { name: 'Apple (Golden Delicious)', icon: 'üçé' },
            '4017': { name: 'Apple (Granny Smith)', icon: 'üçè' },
            '4101': { name: 'Apple (Red Delicious)', icon: 'üçé' },
            '4152': { name: 'Apple (McIntosh)', icon: 'üçé' },
            '3284': { name: 'Apple (Honeycrisp)', icon: 'üçé' },
            '94131': { name: 'Apple (Organic Fuji)', icon: 'üçé' },
            '94139': { name: 'Apple (Organic Granny Smith)', icon: 'üçè' },
            '4046': { name: 'Avocado (Hass)', icon: 'ü•ë' },
            '4225': { name: 'Avocado', icon: 'ü•ë' },
            '94046': { name: 'Avocado (Organic Hass)', icon: 'ü•ë' },
            '4664': { name: 'Tomato (Roma)', icon: 'üçÖ' },
            '4799': { name: 'Tomato (Beefsteak)', icon: 'üçÖ' },
            '3151': { name: 'Tomato (Cherry)', icon: 'üçÖ' },
            '4087': { name: 'Tomato (Grape)', icon: 'üçÖ' },
            '94664': { name: 'Tomato (Organic Roma)', icon: 'üçÖ' },
            '4770': { name: 'Strawberry', icon: 'üçì' },
            '94770': { name: 'Strawberry (Organic)', icon: 'üçì' },
            '4061': { name: 'Lettuce (Green Leaf)', icon: 'ü•¨' },
            '4076': { name: 'Lettuce (Iceberg)', icon: 'ü•¨' },
            '4075': { name: 'Lettuce (Romaine)', icon: 'ü•¨' },
            '4820': { name: 'Lettuce (Red Leaf)', icon: 'ü•¨' },
            '94061': { name: 'Lettuce (Organic Green Leaf)', icon: 'ü•¨' },
            '4012': { name: 'Orange (Navel)', icon: 'üçä' },
            '3107': { name: 'Orange (Valencia)', icon: 'üçä' },
            '4450': { name: 'Orange (Cara Cara)', icon: 'üçä' },
            '94012': { name: 'Orange (Organic Navel)', icon: 'üçä' },
            '4023': { name: 'Grapes (Green)', icon: 'üçá' },
            '4499': { name: 'Grapes (Red)', icon: 'üçá' },
            '4500': { name: 'Grapes (Black)', icon: 'üçá' },
            '94023': { name: 'Grapes (Organic Green)', icon: 'üçá' },
            '4396': { name: 'Blueberry', icon: 'ü´ê' },
            '4409': { name: 'Raspberry', icon: 'ü´ê' },
            '4410': { name: 'Blackberry', icon: 'ü´ê' },
            '94396': { name: 'Blueberry (Organic)', icon: 'ü´ê' },
            '4065': { name: 'Pepper (Green Bell)', icon: 'ü´ë' },
            '4088': { name: 'Pepper (Red Bell)', icon: 'ü´ë' },
            '4689': { name: 'Pepper (Yellow Bell)', icon: 'ü´ë' },
            '4090': { name: 'Pepper (Orange Bell)', icon: 'ü´ë' },
            '4693': { name: 'Pepper (Jalape√±o)', icon: 'üå∂Ô∏è' },
            '4072': { name: 'Potato (Russet)', icon: 'ü•î' },
            '4073': { name: 'Potato (Red)', icon: 'ü•î' },
            '4083': { name: 'Potato (Yukon Gold)', icon: 'ü•î' },
            '4091': { name: 'Sweet Potato', icon: 'üç†' },
            '94072': { name: 'Potato (Organic Russet)', icon: 'ü•î' },
            '4663': { name: 'Onion (Yellow)', icon: 'üßÖ' },
            '4082': { name: 'Onion (Red)', icon: 'üßÖ' },
            '4166': { name: 'Onion (White)', icon: 'üßÖ' },
            '4068': { name: 'Onion (Green/Scallion)', icon: 'üßÖ' },
            '4562': { name: 'Carrot', icon: 'ü•ï' },
            '4094': { name: 'Carrot (Baby)', icon: 'ü•ï' },
            '94562': { name: 'Carrot (Organic)', icon: 'ü•ï' },
            '4060': { name: 'Broccoli', icon: 'ü•¶' },
            '4079': { name: 'Cauliflower', icon: 'ü•¶' },
            '94060': { name: 'Broccoli (Organic)', icon: 'ü•¶' },
            '4062': { name: 'Cucumber', icon: 'ü•í' },
            '3338': { name: 'Cucumber (English)', icon: 'ü•í' },
            '94062': { name: 'Cucumber (Organic)', icon: 'ü•í' },
            '4032': { name: 'Watermelon', icon: 'üçâ' },
            '4050': { name: 'Cantaloupe', icon: 'üçà' },
            '4318': { name: 'Honeydew', icon: 'üçà' },
            '4048': { name: 'Lime', icon: 'üçã' },
            '4053': { name: 'Lemon', icon: 'üçã' },
            '4451': { name: 'Grapefruit', icon: 'üçä' },
            '3115': { name: 'Tangerine', icon: 'üçä' },
            '4044': { name: 'Peach', icon: 'üçë' },
            '4042': { name: 'Nectarine', icon: 'üçë' },
            '4040': { name: 'Plum', icon: 'üçë' },
            '4039': { name: 'Cherry', icon: 'üçí' },
            '4408': { name: 'Apricot', icon: 'üçë' },
            '4030': { name: 'Pineapple', icon: 'üçç' },
            '4051': { name: 'Mango', icon: 'ü•≠' },
            '3114': { name: 'Papaya', icon: 'ü•≠' },
            '4233': { name: 'Kiwi', icon: 'ü•ù' },
            '4414': { name: 'Coconut', icon: 'ü••' },
            '4067': { name: 'Zucchini', icon: 'ü•í' },
            '4750': { name: 'Squash (Butternut)', icon: 'üéÉ' },
            '4759': { name: 'Squash (Acorn)', icon: 'üéÉ' },
            '4784': { name: 'Squash (Spaghetti)', icon: 'üéÉ' },
            '4592': { name: 'Spinach', icon: 'ü•¨' },
            '4591': { name: 'Kale', icon: 'ü•¨' },
            '4613': { name: 'Arugula', icon: 'ü•¨' },
            '3120': { name: 'Swiss Chard', icon: 'ü•¨' },
            '4080': { name: 'Mushroom (White)', icon: 'üçÑ' },
            '4084': { name: 'Mushroom (Portobello)', icon: 'üçÑ' },
            '4081': { name: 'Mushroom (Shiitake)', icon: 'üçÑ' },
            '4885': { name: 'Basil', icon: 'üåø' },
            '4901': { name: 'Cilantro', icon: 'üåø' },
            '4899': { name: 'Parsley', icon: 'üåø' },
            '4889': { name: 'Mint', icon: 'üåø' },
            '4545': { name: 'Celery', icon: 'ü•¨' },
            '4554': { name: 'Eggplant', icon: 'üçÜ' },
            '4548': { name: 'Asparagus', icon: 'ü•í' },
            '4066': { name: 'Corn', icon: 'üåΩ' },
            '3082': { name: 'Pear (Bartlett)', icon: 'üçê' },
            '4416': { name: 'Pear (Anjou)', icon: 'üçê' },
            '4421': { name: 'Pear (Bosc)', icon: 'üçê' }
        };

        // PRODUCE DATA (abbreviated for space - add full data as needed)
        const produceData = {
            'Banana': { storage: 'Store at room temperature. Keep away from direct sunlight.', ripeness: 'Yellow with small brown spots.', season: 'Year-round' },
            'Banana (Organic)': { storage: 'Store at room temperature.', ripeness: 'Yellow with brown spots.', season: 'Year-round' },
            'Apple (Fuji)': { storage: 'Refrigerate for best results.', ripeness: 'Firm with red-pink color.', season: 'October to July' },
            'Apple (Granny Smith)': { storage: 'Refrigerate to maintain crispness.', ripeness: 'Bright green, very firm.', season: 'Year-round' },
            'Apple (Gala)': { storage: 'Store in fridge crisper drawer.', ripeness: 'Red and yellow striped.', season: 'August to March' },
            'Apple (Golden Delicious)': { storage: 'Refrigerate for freshness.', ripeness: 'Golden yellow.', season: 'September to June' },
            'Apple (Red Delicious)': { storage: 'Keep refrigerated.', ripeness: 'Deep red color, firm.', season: 'September to July' },
            'Apple (McIntosh)': { storage: 'Best when refrigerated.', ripeness: 'Red with green, soft when ripe.', season: 'September to May' },
            'Apple (Honeycrisp)': { storage: 'Refrigerate to maintain crunch.', ripeness: 'Red and yellow, very crisp.', season: 'September to January' },
            'Apple (Organic Fuji)': { storage: 'Refrigerate for best results.', ripeness: 'Firm with red-pink color.', season: 'October to July' },
            'Apple (Organic Granny Smith)': { storage: 'Refrigerate.', ripeness: 'Bright green, firm.', season: 'Year-round' },
            'Avocado': { storage: 'Ripen at room temp, then refrigerate.', ripeness: 'Yields to gentle pressure.', season: 'Year-round' },
            'Avocado (Hass)': { storage: 'Ripen at room temp.', ripeness: 'Dark skin, yields to pressure.', season: 'Year-round' },
            'Avocado (Organic Hass)': { storage: 'Ripen at room temp.', ripeness: 'Dark skin, yields to pressure.', season: 'Year-round' },
            'Tomato (Roma)': { storage: 'Room temperature, never refrigerate.', ripeness: 'Deep red, firm.', season: 'June to September' },
            'Tomato (Beefsteak)': { storage: 'Room temperature.', ripeness: 'Large, deep red.', season: 'Summer' },
            'Tomato (Cherry)': { storage: 'Room temperature for best flavor.', ripeness: 'Bright red, firm.', season: 'Year-round' },
            'Tomato (Grape)': { storage: 'Room temperature.', ripeness: 'Deep red, glossy.', season: 'Year-round' },
            'Tomato (Organic Roma)': { storage: 'Room temperature.', ripeness: 'Deep red, firm.', season: 'June to September' },
            'Strawberry': { storage: 'Refrigerate unwashed.', ripeness: 'Bright red, fresh green caps.', season: 'April to June' },
            'Strawberry (Organic)': { storage: 'Refrigerate unwashed.', ripeness: 'Bright red.', season: 'April to June' }
        };

        // NUTRITION DATABASE (abbreviated - you can add the full list from app.js)
        const nutritionData = {
            'Banana': { calories: 105, carbs: '27g', protein: '1.3g', fiber: '3g', potassium: '422mg', vitaminC: '10mg' },
            'Banana (Organic)': { calories: 105, carbs: '27g', protein: '1.3g', fiber: '3g', potassium: '422mg', vitaminC: '10mg' },
            'Apple (Fuji)': { calories: 95, carbs: '25g', protein: '0.5g', fiber: '4g', sugar: '19g', vitaminC: '8mg' },
            'Apple (Granny Smith)': { calories: 80, carbs: '22g', protein: '0.4g', fiber: '4g', sugar: '15g', vitaminC: '10mg' },
            'Avocado': { calories: 234, carbs: '12g', protein: '3g', fiber: '10g', fat: '21g', potassium: '690mg' },
            'Avocado (Hass)': { calories: 234, carbs: '12g', protein: '3g', fiber: '10g', fat: '21g', potassium: '690mg' },
            'Tomato (Roma)': { calories: 35, carbs: '7g', protein: '1.5g', fiber: '2g', vitaminC: '24mg', vitaminA: '1025IU' },
            'Strawberry': { calories: 49, carbs: '12g', protein: '1g', fiber: '3g', sugar: '7g', vitaminC: '89mg' }
        };

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            if (pageId !== 'landing') {
                document.getElementById('nav').style.display = 'flex';
            } else {
                document.getElementById('nav').style.display = 'none';
            }

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const navButtons = document.querySelectorAll('.nav-btn');
            if (pageId === 'landing') navButtons[0]?.classList.add('active');
            if (pageId === 'inventory') navButtons[1]?.classList.add('active');
            if (pageId === 'settings') navButtons[2]?.classList.add('active');

            if (pageId === 'inventory') {
                updateCollectionDisplay();
            }
        }

        function searchMainPLU() {
            const input = document.getElementById('mainPLUInput');
            const code = input.value.trim();
            if (code) {
                lookupPLU(code);
                input.value = '';
            }
        }

        function startScanner() {
            const isSecure = window.location.protocol === 'https:' || 
                           window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1';
            
            if (!isSecure) {
                alert('‚ö†Ô∏è Camera requires HTTPS or localhost.');
                return;
            }

            const container = document.getElementById('scanner-container');
            container.classList.add('active');
            scannerActive = true;

            if (typeof Quagga === 'undefined') {
                alert('Scanner library not loaded.');
                stopScanner();
                return;
            }

            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-video'),
                    constraints: {
                        width: { min: 640, ideal: 1280 },
                        height: { min: 480, ideal: 720 },
                        facingMode: "environment"
                    },
                },
                decoder: {
                    readers: ["ean_reader", "ean_8_reader", "code_128_reader", "code_39_reader", "upc_reader", "upc_e_reader"]
                },
                locate: true
            }, function(err) {
                if (err) {
                    alert('Camera error. Use manual PLU entry.');
                    stopScanner();
                    return;
                }
                Quagga.start();
            });

            Quagga.onDetected(function(result) {
                const code = result.codeResult.code;
                if (navigator.vibrate) navigator.vibrate(100);
                lookupPLU(code);
            });
        }

        function stopScanner() {
            if (scannerActive) {
                Quagga.stop();
                Quagga.offDetected();
                scannerActive = false;
            }
            document.getElementById('scanner-container').classList.remove('active');
        }

        function lookupPLU(code) {
            const cleanCode = code.replace(/^0+/, '');
            if (pluDatabase[cleanCode]) {
                stopScanner();
                const produce = pluDatabase[cleanCode];
                selectProduce(produce.name, produce.icon);
            } else {
                const text = document.querySelector('.scanner-text');
                text.textContent = `PLU ${cleanCode} not found.`;
                text.style.color = '#ff3b30';
                setTimeout(() => {
                    text.textContent = 'Position barcode or PLU sticker within frame';
                    text.style.color = '#FFF7ED';
                }, 2000);
            }
        }

        function lookupManualPLU() {
            const input = document.getElementById('manualPLU');
            const code = input.value.trim();
            if (code) {
                lookupPLU(code);
                input.value = '';
            }
        }

        function selectProduce(name, icon) {
            currentProduce = { name, icon, addedDate: new Date() };
            
            const data = produceData[name] || { storage: 'Store properly', ripeness: 'Check for freshness', season: 'Varies' };
            const nutrition = nutritionData[name] || { calories: 'N/A', carbs: 'N/A', protein: 'N/A', fiber: 'N/A' };
            
            document.getElementById('infoIcon').textContent = icon;
            document.getElementById('infoTitle').textContent = name;
            document.getElementById('infoStorage').textContent = data.storage;
            document.getElementById('infoRipeness').textContent = data.ripeness;
            document.getElementById('infoSeason').textContent = data.season;
            
            const nutritionGrid = document.getElementById('nutritionGrid');
            nutritionGrid.innerHTML = '';
            
            Object.entries(nutrition).forEach(([key, value]) => {
                const label = key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1');
                nutritionGrid.innerHTML += `
                    <div class="nutrition-item">
                        <div class="nutrition-value">${value}</div>
                        <div class="nutrition-label">${label}</div>
                    </div>
                `;
            });
            
            showPage('produceInfo');
        }

        function addToCollection() {
            if (currentProduce) {
                const exists = collection.some(item => item.name === currentProduce.name);
                if (!exists) {
                    collection.push({...currentProduce, id: Date.now()});
                    alert(`${currentProduce.icon} ${currentProduce.name} added!`);
                } else {
                    alert(`${currentProduce.icon} ${currentProduce.name} already in collection!`);
                }
                showPage('inventory');
            }
        }

        function updateCollectionDisplay() {
            const grid = document.getElementById('collectionGrid');
            if (collection.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì¶</div>
                        <p>No items yet<br>Start by scanning produce!</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = collection.map(item => `
                <div class="collection-item" onclick="viewCollectionItem('${item.name}', '${item.icon}')">
                    <button class="remove-btn" onclick="event.stopPropagation(); removeFromCollection(${item.id})">‚úï</button>
                    <div class="collection-icon">${item.icon}</div>
                    <div class="collection-name">${item.name}</div>
                    <div class="collection-date">${item.addedDate.toLocaleDateString()}</div>
                </div>
            `).join('');
        }

        function viewCollectionItem(name, icon) {
            selectProduce(name, icon);
        }

        function removeFromCollection(id) {
            const item = collection.find(i => i.id === id);
            if (item && confirm(`Remove ${item.icon} ${item.name}?`)) {
                collection = collection.filter(i => i.id !== id);
                updateCollectionDisplay();
            }
        }

        function clearCollection() {
            if (collection.length === 0) {
                alert('Collection is already empty!');
                return;
            }
            if (confirm(`Remove all ${collection.length} items?`)) {
                collection = [];
                updateCollectionDisplay();
                alert('Collection cleared!');
            }
        }

        function toggleSetting(element) {
            element.classList.toggle('active');
        }

        // Event Listeners
        document.getElementById('mainPLUInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchMainPLU();
        });

        document.getElementById('manualPLU')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') lookupManualPLU();
        });
    </script>
</body>
</html>